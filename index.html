<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Long-press</title>
	<style>
		body {
			background-color: black;
			padding: 0;
			margin: 0;
			width: 100dvw;
			height: 100dvh;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.target {
			width: 10ch;
			height: 10ch;
			background-color: gray;
			border-radius: 50%;
		}
	</style>
</head>
<body>
	<div class="target"></div>
	<script>
		function longPressable({ holdTime, selector }) {
			// Closure state
			const target = document.querySelector(selector);
			let timeoutId = null;

			// Let the value of timeoutId indicate if LongPressEnd has fired

			function timeoutEnd() {
				clearTimeout(timeoutId);
				timeoutId = null;
				target.dispatchEvent(new CustomEvent("longpressend", {detail: {holdTime}}));
			}

			function onMouseDown() {
				// If for some reason the timer is already set, do nothing. This
				// shouldn't happen.
				if (timeoutId !== null) {
					console.error('LongPress: error');
					clearTimeout(timeoutId);
					return;
				}
				timeoutId = setTimeout(timeoutEnd, holdTime);
				target.dispatchEvent(new CustomEvent("longpressstart", {detail: {holdTime}}));
			}

			function onMouseUp() {
				if (timeoutId === null) {
					return;
				}

				clearTimeout(timeoutId);
				timeoutId = null;
				target.dispatchEvent(new CustomEvent("longpresscancel", {detail: {holdTime}}));
			}

			target.addEventListener('mousedown', onMouseDown);
			target.addEventListener('mouseup', onMouseUp);
		}

		const target = document.querySelector('.target');

		target.addEventListener('longpressstart', console.log);
		target.addEventListener('longpresscancel', console.log);
		target.addEventListener('longpressend', console.log);

		longPressable({ holdTime: 1000, selector: '.target' });
		longPressable({ holdTime: 3000, selector: '.target' });
	</script>
</body>
</html>